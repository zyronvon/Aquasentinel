<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AquaSentinel</title>
    <meta name="description" content="AquaSentinel dashboard showing CNN model results for microplastics detection.">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation -->
    <div class="nav-container">
        <nav>
            <a href="index.html" class="logo">AquaSentinel</a>
            <ul class="nav-links" id="navLinks">
                <li><a href="dashboard.html" class="active">Dashboard</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="about.html">Project info</a></li>
                <li><a href="#" onclick="signOut()" class="btn-secondary">Sign Out</a></li>
            </ul>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
        </nav>
    </div>

    <!-- Main Content -->
    <main>
        <div class="container fade-in">
            <div class="flex justify-between align-center mb-2" style="gap: 1.5rem; flex-wrap: wrap;">
                <div>
                    <h1 style="color: var(--accent); font-size: 2.2rem;">Model Results Dashboard</h1>
                    <p style="color: var(--muted); font-size: 0.95rem; max-width: 480px; margin-top: 0.35rem;">
                        Inspect CNN microplastics predictions, confidence distributions, and error patterns from the latest analysis run.
                    </p>
                </div>
                <div class="flex gap-1" style="align-items: center; flex-wrap: wrap;">
                    <span style="font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.12em; color: #9ca3af;">
                        Export
                    </span>
                    <button id="exportBtn" class="btn" onclick="exportCSV()">ðŸ“¥ Export CSV</button>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- CSV Data Card -->
                <div class="data-card">
                    <h3>Prediction results</h3>
                    <p style="color: var(--muted); font-size: 0.85rem; margin-bottom: 1rem;">
                        Tabular view of sample-level predictions streamed from the latest GitHub export.
                    </p>
                    <div class="table-controls">
                        <div class="table-filters">
                            <button type="button" class="chip active" data-filter="all">All</button>
                            <button type="button" class="chip" data-filter="high">High â‰¥80%</button>
                            <button type="button" class="chip" data-filter="medium">50â€“80%</button>
                            <button type="button" class="chip" data-filter="low">Low &lt;50%</button>
                        </div>
                        <div class="table-meta">
                            <span id="tableRowCount" class="table-meta-text"></span>
                        </div>
                    </div>
                    <div id="csvLoading" class="loading">Loading prediction data...</div>
                    <div id="csvError" class="error hidden">Failed to load prediction data. Please try again.</div>
                    <div class="table-container" id="csvTableContainer" style="display: none;">
                        <table id="csvTable">
                            <thead id="csvTableHead"></thead>
                            <tbody id="csvTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Confidence Histogram -->
                <div class="data-card">
                    <h3>Confidence distribution</h3>
                    <p style="color: var(--muted); font-size: 0.85rem; margin-bottom: 1rem;">
                        Aggregated confidence scores across all predictions to reveal calibration and uncertainty.
                    </p>
                    <div id="histogramLoading" class="loading">Loading confidence histogram...</div>
                    <div id="histogramError" class="error hidden">Failed to load confidence histogram.</div>
                    <div class="chart-container" id="histogramContainer" style="display: none;">
                        <img id="histogramImg" alt="Confidence Histogram" onclick="openModal(this)">
                    </div>
                </div>

                <!-- Misclassified Samples -->
                <div class="data-card">
                    <h3>Misclassified samples</h3>
                    <p style="color: var(--muted); font-size: 0.85rem; margin-bottom: 1rem;">
                        Visual diagnostics for samples where predicted and reference classes disagree.
                    </p>
                    <div id="misclassifiedLoading" class="loading">Loading misclassified samples...</div>
                    <div id="misclassifiedError" class="error hidden">Failed to load misclassified samples.</div>
                    <div class="chart-container" id="misclassifiedContainer" style="display: none;">
                        <img id="misclassifiedImg" alt="Misclassified Samples" onclick="openModal(this)">
                    </div>
                </div>

                <!-- Sample Predictions -->
                <div class="data-card">
                    <h3>Sample predictions</h3>
                    <p style="color: var(--muted); font-size: 0.85rem; margin-bottom: 1rem;">
                        Example predictions and probability mass to build intuition about what the model sees.
                    </p>
                    <div id="samplesLoading" class="loading">Loading sample predictions...</div>
                    <div id="samplesError" class="error hidden">Failed to load sample predictions.</div>
                    <div class="chart-container" id="samplesContainer" style="display: none;">
                        <img id="samplesImg" alt="Sample Predictions" onclick="openModal(this)">
                    </div>
                </div>
            </div>

            <!-- Statistics Summary -->
            <div class="card mt-2">
                <h3>Summary statistics</h3>
                <div id="statsContainer" class="flex justify-between gap-1" style="flex-wrap: wrap;">
                    <div class="stat-item" style="background: rgba(15,23,42,0.95); padding: 1rem; border-radius: 8px; text-align: center; min-width: 150px;">
                        <div style="font-size: 1.8rem; color: var(--accent); font-weight: 700;" id="totalSamples">-</div>
                        <div style="color: var(--muted);">Total samples</div>
                    </div>
                    <div class="stat-item" style="background: rgba(15,23,42,0.95); padding: 1rem; border-radius: 8px; text-align: center; min-width: 150px;">
                        <div style="font-size: 1.8rem; color: var(--accent); font-weight: 700;" id="avgConfidence">-</div>
                        <div style="color: var(--muted);">Avg confidence</div>
                    </div>
                    <div class="stat-item" style="background: rgba(15,23,42,0.95); padding: 1rem; border-radius: 8px; text-align: center; min-width: 150px;">
                        <div style="font-size: 1.8rem; color: var(--accent); font-weight: 700;" id="highConfSamples">-</div>
                        <div style="color: var(--muted);">High confidence (â‰¥80%)</div>
                    </div>
                    <div class="stat-item" style="background: rgba(15,23,42,0.95); padding: 1rem; border-radius: 8px; text-align: center; min-width: 150px;">
                        <div style="font-size: 1.8rem; color: var(--accent); font-weight: 700;" id="lowConfSamples">-</div>
                        <div style="color: var(--muted);">Low confidence (&lt;50%)</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container footer-grid">
            <div class="footer-column">
                <h4>AquaSentinel</h4>
                <p>Data-forward insights into microplastics predictions and model behavior.</p>
            </div>
            <div class="footer-column">
                <h5>Navigation</h5>
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="profile.html">Profile</a></li>
                    <li><a href="about.html">Project info</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h5>Research</h5>
                <ul>
                    <li><a href="about.html">About the Project</a></li>
                    <li><a href="https://github.com/zyronvon/Microplastics_results" target="_blank" rel="noopener noreferrer">GitHub Repository</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="container">
                <p>Â© 2024 AquaSentinel â€¢ Dashboard interface for microplastics analysis</p>
            </div>
        </div>
    </footer>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <img id="modalImage" alt="Enlarged view">
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
